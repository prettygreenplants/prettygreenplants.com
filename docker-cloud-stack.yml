app:
  autoredeploy: true
  environment:
    FLOW_CONTEXT: 'Production'
  image: 'prettygreenplants/app:latest'
  links:
    - db
    - redis
  target_num_containers: 1
  volumes:
    - '/var/www/prettygreenplants:/var/www'

db:
  image: 'mariadb:10.1'
  command: mysqld --character-set-server=utf8 --collation-server=utf8_unicode_ci
  environment:
    MYSQL_DATABASE: 'prettygreenplants'
    MYSQL_PASSWORD: 'prettygreenplants'
    MYSQL_ROOT_PASSWORD: 'root'
    MYSQL_USER: 'prettygreenplants'
  target_num_containers: 1
  volumes:
    - '/var/www/prettygreenplants:/var/www'
    - '/var/lib/mysql:/var/lib/mysql'

redis:
  image: redis:alpine
  target_num_containers: 1

web:
  image: prettygreenplants/nginx:latest
  autoredeploy: true
  environment:
    NGINX_HOST: 'prettygreenplants.com'
    USE_SELF_SIGNED_CERTIFICATE: false
  links:
    - app
  ports:
    - '80:80'
    - '443:443'
  target_num_containers: 1
  volumes:
    - '/var/www/prettygreenplants/neos:/var/www'
    - '/etc/letsencrypt:/etc/letsencrypt'
